<html>
<head>
<title>Web Solar Widget</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
	<script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/modules/exporting.js"></script>
	<style>
		.highcharts-legend-item .highcharts-point,
		.highcharts-legend-item .highcharts-graph {
		  display: none
		}
	</style>
</head>
<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>

<div class="container-fluid">
	<div class="row full-screen">
		<button id="btn" class="btn btn-info">FullScreen</button>
	</div>
	<div class="row d-flex justify-content-center">
		<div class="col-sm-12 col-lg-10" id="solar"></div>
	</div>	
</div>
<script>

	$.ajax({
            headers: { "Accept": "application/json"},
            type: 'GET',
            url: 'https://gifted-runner-259805.appspot.com/',
            crossDomain: true,
            beforeSend: function(xhr){
                xhr.withCredentials = true;
          },
            success: function(data, textStatus, request){
				var jsonData = JSON.parse(data.data);
				drawChart(jsonData);
            }
 	});
	 
	power2gridData = [[1575129600000,0.0],[1575129900000,0.0],[1575130200000,0.0],[1575130500000,0.0],[1575130800000,0.0],[1575131100000,0.0],[1575131400000,0.0],[1575131700000,0.0],[1575132000000,0.0],[1575132300000,0.0],[1575132600000,0.0],[1575132900000,0.0],[1575133200000,0.0],[1575133500000,0.0],[1575133800000,0.0],[1575134100000,0.0],[1575134400000,0.0],[1575134700000,0.0],[1575135000000,0.0],[1575135300000,0.0],[1575135600000,0.0],[1575135900000,0.0],[1575136200000,0.0],[1575136500000,0.0],[1575136800000,0.0],[1575137100000,0.0],[1575137400000,0.0],[1575137700000,0.0],[1575138000000,0.0],[1575138300000,0.0],[1575138600000,0.0],[1575138900000,0.0],[1575139200000,0.0],[1575139500000,0.0],[1575139800000,0.0],[1575140100000,0.0],[1575140400000,0.0],[1575140700000,0.0],[1575141000000,0.0],[1575141300000,0.0],[1575141600000,0.0],[1575141900000,0.0],[1575142200000,0.0],[1575142500000,0.0],[1575142800000,0.0],[1575143100000,0.0],[1575143400000,0.0],[1575143700000,0.0],[1575144000000,0.0],[1575144300000,0.0],[1575144600000,0.0],[1575144900000,0.0],[1575145200000,0.0],[1575145500000,0.0],[1575145800000,0.0],[1575146100000,0.0],[1575146400000,0.0],[1575146700000,0.0],[1575147000000,0.0],[1575147300000,0.0],[1575147600000,0.0],[1575147900000,0.0],[1575148200000,0.0],[1575148500000,0.0],[1575148800000,0.0],[1575149100000,0.0],[1575149400000,0.0],[1575149700000,0.0],[1575150000000,0.0],[1575150300000,0.0],[1575150600000,0.0],[1575150900000,0.0],[1575151200000,0.0],[1575151500000,0.0],[1575151800000,0.0],[1575152100000,0.0],[1575152400000,0.0],[1575152700000,0.0],[1575153000000,0.0],[1575153300000,0.0],[1575153600000,0.0],[1575153900000,0.0],[1575154200000,0.0],[1575154500000,0.0],[1575154800000,24.00],[1575155100000,0.0],[1575155400000,190.73],[1575155700000,312.00],[1575156000000,480.00],[1575156300000,576.00],[1575156600000,672.00],[1575156900000,792.00],[1575157200000,984.00],[1575157500000,768.00],[1575157800000,744.00],[1575158100000,960.00],[1575158400000,1152.00],[1575158700000,1056.00],[1575159000000,864.00],[1575159300000,1200.00],[1575159600000,864.00],[1575159900000,984.00],[1575160200000,1104.00],[1575160500000,1512.00],[1575160800000,1464.00],[1575161100000,1192.05],[1575161400000,1032.00],[1575161700000,1392.00],[1575162000000,1344.00],[1575162300000,984.00],[1575162600000,816.00],[1575162900000,960.00],[1575163200000,1152.00],[1575163500000,1056.00],[1575163800000,1128.00],[1575164100000,1152.00],[1575164400000,1104.00],[1575164700000,888.00],[1575165000000,1536.00],[1575165300000,1416.00],[1575165600000,1560.00],[1575165900000,1272.00],[1575166200000,1656.00],[1575166500000,1704.00],[1575166800000,1440.00],[1575167100000,1272.00],[1575167400000,1406.62],[1575167700000,1104.00],[1575168000000,1272.00],[1575168300000,1008.00],[1575168600000,1104.00],[1575168900000,1296.00],[1575169200000,1080.00],[1575169500000,888.00],[1575169800000,792.00],[1575170100000,720.00],[1575170400000,1176.00],[1575170700000,1176.00],[1575171000000,720.00],[1575171300000,504.00],[1575171600000,672.00],[1575171900000,1056.00],[1575172200000,936.00],[1575172500000,504.00],[1575172800000,480.00],[1575173100000,504.00],[1575173400000,360.00],[1575173700000,144.00],[1575174000000,816.00],[1575174300000,1128.00],[1575174600000,576.00],[1575174900000,168.00],[1575175200000,336.00],[1575175500000,384.00],[1575175800000,312.00],[1575176100000,95.36],[1575176400000,120.00],[1575176700000,168.00],[1575177000000,0.0],[1575177300000,0.0],[1575177600000,0.0],[1575177900000,0.0],[1575178200000,0.0],[1575178500000,0.0],[1575178800000,0.0],[1575179100000,0.0],[1575179400000,0.0],[1575179700000,0.0],[1575180000000,0.0],[1575180300000,0.0],[1575180600000,0.0],[1575180900000,0.0],[1575181200000,0.0],[1575181500000,0.0],[1575181800000,0.0],[1575182100000,0.0],[1575182400000,0.0],[1575182700000,0.0],[1575183000000,0.0],[1575183300000,0.0],[1575183600000,0.0],[1575183900000,0.0],[1575184200000,0.0],[1575184500000,0.0],[1575184800000,0.0],[1575185100000,0.0],[1575185400000,0.0],[1575185700000,0.0],[1575186000000,0.0],[1575186300000,0.0],[1575186600000,0.0],[1575186900000,0.0],[1575187200000,0.0],[1575187500000,0.0],[1575187800000,0.0],[1575188100000,0.0],[1575188400000,0.0],[1575188700000,0.0],[1575189000000,0.0],[1575189300000,0.0],[1575189600000,0.0],[1575189900000,0.0],[1575190200000,0.0],[1575190500000,0.0],[1575190800000,0.0],[1575191100000,0.0],[1575191400000,0.0],[1575191700000,0.0],[1575192000000,0.0],[1575192300000,0.0],[1575192600000,0.0],[1575192900000,0.0],[1575193200000,0.0],[1575193500000,0.0],[1575193800000,0.0],[1575194100000,0.0],[1575194400000,0.0],[1575194700000,0.0],[1575195000000,0.0],[1575195300000,0.0],[1575195600000,0.0],[1575195900000,0.0],[1575196200000,0.0],[1575196500000,0.0],[1575196800000,0.0],[1575197100000,0.0],[1575197400000,0.0],[1575197700000,0.0],[1575198000000,0.0],[1575198300000,0.0],[1575198600000,0.0],[1575198900000,0.0],[1575199200000,0.0],[1575199500000,0.0],[1575199800000,0.0],[1575200100000,0.0],[1575200400000,0.0],[1575200700000,0.0],[1575201000000,0.0],[1575201300000,0.0],[1575201600000,0.0],[1575201900000,0.0],[1575202200000,0.0],[1575202500000,0.0],[1575202800000,0.0],[1575203100000,0.0],[1575203400000,0.0],[1575203700000,0.0],[1575204000000,0.0],[1575204300000,0.0],[1575204600000,0.0],[1575204900000,0.0],[1575205200000,0.0],[1575205500000,0.0]];

function Unix_timestamp(t) {
	var dt = new Date(t);
	var hr = dt.getHours();
	var m = "0" + dt.getMinutes();
	return hr+ ':' + m.substr(-2);  
}

function drawChart(data) {
	
	consumptionData = data.settings.series[0].data;
	solarProductionData = data.settings.series[2].data;
	x_min_1 = data.settings.xAxis.min;
	x_max_1 = data.settings.xAxis.max;

	Highcharts.seriesTypes.scatter.prototype.drawLegendSymbol = Highcharts.seriesTypes.column.prototype.drawLegendSymbol;
	$("#a1").click(function () {
        $('.highcharts-legend-item:nth-child(1)').click();
        $(this).toggleClass("leg-clicked");
    });
 	
 	Highcharts.setOptions({
        global : {
            useUTC : false
        }
    });

 	var chooseMode = ["line", "areaspline"];
 	var fullScreenMode = 0;

    var myChart = Highcharts.chart('solar', {
    	title: {	
    		text: "TVOH 1 10kW 201-263"
    	},
    	chart: { 
    		type: chooseMode[0]
    	},
    	credits: {
		  enabled: false
		},
    	exporting: { enabled: false },
		plotOptions: {
	    	areaspline: {
	            fillOpacity: 0.5
	        },
            series: {
                marker: {
                    enabled: false
                },
                lineWidth: 1,
	            states: {
	                hover: {
	                    enabled: true,
	                    lineWidth: 1
	                }
	            },
            }
        },
		xAxis: {
	    	type:"datetime",
	    	max: x_max_1,
	    	min: x_min_1,
	    	crosshair:false,
	    	tickWidth:1,
	    	tickColor:"#ECEDED",
	    	labels: {
	    		step: 3
	    	},
	    },
	    yAxis: {
	    	gridLineWidth: 0,
			minorGridLineWidth: 0,
			tickInterval: 4500,
			tickWidth: 32,
			offset: 0,
			tickLength: 0,
			tickPosition: 'inside',
			tickAmount: 5,
			min: 0,
	    	title: {
			    align: 'high',
			    text: 'Kw',
			    style: {
			      'text-anchor': 'start'
			    },
			    rotation: 0,
			    y: -20,
			    x: 30,
			    textAlign: 'center'
			}
	    },
	    legend: {
    	   layout: 'vertical',
		   align: 'center',
		   verticalAlign: 'top',
		   itemMarginTop: 0,
		   itemMarginBottom: 0,
		   useHTML: true,
		   labelFormatter: function() {
		   	
		   	if(this.index == 0){
     	        return '<div class="label-legend" style="width:180px; height: 20px;"><svg width="12" height="12"><rect width="12" height="12" style="fill:rgb(0,123,255);stroke-width:1;stroke:rgb(0,123,255)" />'+'</svg>'+'<span class="username">' + this.name +'</span></div>';
			}
			if(this.index == 1) {
				return '<div class="label-legend" style="width:180px; height: 20px;"><svg width="12" height="12"><rect width="12" height="12" style="fill:rgb(255,255,51);stroke-width:1;stroke:rgb(255,255,51)" />'+'</svg>'+'<span class="username">' + this.name +'</span></div>';
			}
		   }
	    },
	    series	: [{
	    	name: 'Electricity Consumption',
	    	type: 'line',
	    	color: "rgb(0,123,255)",
			dashStyle: "solid",
			lineWidth: 2,
			showInLegend: true,
	        data: consumptionData,
	        marker: {
		        symbol: 'circle'
		      },
		},{
	    	name: "Solar Production",
	    	type: 'areaspline',
	    	color: "rgb(255,255,51)",
	    	lineColor: "black",
			dashStyle: "solid",
			lineWidth: 2,
			borderColor: 'black',
        	borderWidth: 1,
	    	showInLegend: true,
	    	data: solarProductionData,
	    	borderColor: 'black',
        	borderWidth: 0.2,
	    }],
	    tooltip: {

	    	valueDecimals: 2,
			valueSuffix: "W",
	    	shared: false,
            formatter: function () {
            	var serie = this.series;

                var s = '';
                s += '<span>'+ Unix_timestamp(this.x) +'</span><br>';
                s += '<span style="color:' + serie.color + '">' + serie.options.name + '</span>: <b>' + this.y + '<span style="color:' + serie.color + '">w</span></b><br/>';
                // s += '<span style="display: flex; justify-content: space-between "'+ 'Hello'+'World' +'</span>';
                $.each(serie.options.composition, function(name, value) {
                    s += '<b><span>' + name + 'aaaaa:</span></b><span style="align-self: right;"> ' + value + 'w </span><br>';
                });
                return s;
            }
        },
	});

	$( "div.label-legend" ).parent().css( "position", "relative" );
	
	let btn = document.getElementById("btn")

	btn.addEventListener('click', function() {
	  Highcharts.FullScreen = function(container) {
	    this.init(container.parentNode);
	  };

	  Highcharts.FullScreen.prototype = {
	    init: function(container) {
	      if (container.requestFullscreen) {
	        container.requestFullscreen();
	      } else if (container.mozRequestFullScreen) {
	        container.mozRequestFullScreen();
	      } else if (container.webkitRequestFullscreen) {
	        container.webkitRequestFullscreen();
	      } else if (container.msRequestFullscreen) {
	        container.msRequestFullscreen();
	      }
	    }
	  };
	  myChart.fullscreen = new Highcharts.FullScreen(myChart.container);
	});
}

</script>

<style>
@media (max-width: 575px) {
	.container-fluid {
		margin-top: 70px;
	}

	.full-screen {
		display: none;
	    position: absolute;
	    right: 21%;
	    top: 32%;
	    z-index: 2;
	}

	div.label-legend {
		display: none;
	}

	.full-screen .btn {
		font-size: 6px;
	}

	#solar {
		width: 100%;
		height: 30%;
		position: absolute;
	}

	.username {
		font-size: 8px;
		margin-left: 5px;
	}

	.label-legend {
		position: absolute;
		left: 118px;
	}
}

@media (min-width: 576px) {
	.container-fluid {
		margin-top: 100px;
	}

	.full-screen {
		display: none;
	    position: absolute;
	    right: 15%;
	    top: 36%;
	    z-index: 2;
	}

	.full-screen .btn {
		font-size: 8px;
	}

	#solar {
		width: 100%;
		height: 30%;
		position: absolute;
	}

	.username {
		font-size: 10px;
		margin-left: 5px;
	}

	.label-legend {
		position: absolute;
		left: 118px;
	}
}


@media (min-width: 768px) {
	.container-fluid {
		margin-top: 80px;
	}

	.full-screen {
		display: none;
	    position: absolute;
	    right: 8%;
	    top: 42%;
	    z-index: 2;
	}

	.full-screen .btn {
		font-size: 11px;
	}

	#solar {
		width: 100%;
		height: 40%;
		position: absolute;
	}

	.username {
		font-size: 12px;
		margin-left: 7px;
	}

	.label-legend {
		position: absolute;
		left: 250px;
	}

}


@media (min-width: 992px) {
	.container-fluid {
		margin-top: 100px;
	}

	.full-screen {
		display: none;
	    position: absolute;
	    right: 13%;
	    top: 63%;
	    z-index: 2;
	}

	.full-screen .btn {
		font-size: 14px;
	}

	#solar {
		width: 100%;
		height: 60%;
		position: absolute;
	}

	.username {
		font-size: 13px;
		margin-left: 10px;
	}

	.label-legend {
		position: absolute;
		left: 205px;
	}
}


@media (min-width: 1200px) { 
	.label-legend {
		position: absolute;
		left: 315px;
	}
}
</style>

</body>
</html>